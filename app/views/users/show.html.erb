<div class="my-3 col-sm-6 mx-auto">
  <div class="text-center mb-2 text-dark"><span><%= @user.rate_class.html_safe %></span><%= "#{@user.name} 様 の実績" %></div>
  <hr class="mt-2 mb-4 w-50">
  <div class="card-body border shadow-sm mb-3 py-2">
    <div class="text-dark p-2 small">
      <div>成績</div>
      <table class="table table-bordered table-striped">
        <tr>
          <th nowrap class="p-2 text-center w-50">ランク</th>
          <% if @user_rank == "-" %>
            <th nowrap class="p-2 text-center"><span class=""><%= @user_rank %></span></th>
          <% else %>
            <th nowrap class="p-2 text-center"><span class="<%= 'text-danger' if @user_rank <= 3 %>"><%= @user_rank %></span><%= "/#{@users.length} 位" %></th>
          <% end %>
        </tr>
        <tr>
          <th nowrap class="text-center w-50">レート</th>
          <th nowrap class="text-center"><%= @user.rate %></th>
        </tr>
        <tr>
          <th nowrap class="text-center w-50">最高レート</th>
          <th nowrap class="text-center"><%= @user.max_rate %></th>
        </tr>
        <tr>
          <th nowrap class="text-center w-50"><i class="fa-solid fa-fire-flame-curved text-danger"></i></th>
          <th nowrap class="text-center"><%= "#{@first_oogiris.length}個" %></th>
        </tr>
        <tr>
          <th nowrap class="text-center w-50"><i class="fa-solid fa-skull text-dark"></i></th>
          <th nowrap class="text-center"><%= "#{@minus_oogiris.length}個" %></th>
        </tr>
      </table>
    </div>
  </div>
  <div class="card-body border shadow-sm mb-3 py-2">
    <div class="text-dark p-2 small">
      <div>アクティビティ</div>
      <table class="table table-bordered mb-2">
        <tr>
          <th nowrap class="p-2 text-center w-50">大喜利を始めた年</th>
          <th nowrap class="p-2 text-center"><%= @user.oogiri_start.strftime('%Y年') %></th>
        </tr>
      </table>
      <table class="table table-bordered table-striped mb-1">
        <tr class="">
          <th nowrap class="p-2 text-center w-50">
            投稿回数（率<span class="small text-muted">*1</span>）
          </th>
          <th nowrap class="p-2 text-center align-middle">
            <% if @fields_num == 0 %>
              <%= "#{@user_oogiris.length}回 (-%)" %>
            <% else %>
              <%= "#{@user_oogiris.length}回 (#{(@user_oogiris.length.to_f / @fields_num.to_f * 100).round(1)}%)" %>
            <% end %>
          </th>
        </tr>
        <tr>
          <th nowrap class="text-center w-50">
            投票回数（率<span class="small text-muted">*2</span>）
          </th>
          <th nowrap class="text-center align-middle">
            <% if @fields_num == 0 %>
              <%= "#{@user_votes_num}回 (-%)" %>
            <% else %>
              <%= "#{@user_votes_num}回 (#{(@user_votes_num.to_f / @fields_num.to_f * 100).round(1)}%)" %>
            <% end %>
          </th>
        </tr>
        <tr>
          <th nowrap class="text-center w-50">
            コメント回数（率<span class="small text-muted">*3</span>）
          </th>
          <th nowrap class="text-center align-middle">
            <% if @user_minus_votes_num == 0 %>
              <%= "#{@user_comments.length}回 (-%)" %>
            <% else %>
              <%= "#{@user_comments.length}回 (#{(@user_comments.length.to_f / @user_minus_votes_num.to_f * 100).round(1)}%)" %>
            <% end %>
          </th>
        </tr>
      </table>
      <div>
        <span class="small text-muted">*1 投稿回数／登録後に結果が出たお題の数</span><br>
        <span class="small text-muted">*2 投票回数／登録後に結果が出たお題の数</span><br>
        <span class="small text-muted">*3 コメント回数／マイナス点の投票回数</span>
      </div>
    </div>
  </div>
  <ul class="nav nav-tabs justify-content-around" role="tablist">
    <li class="nav-item" role="presentation">
      <a href="#user_oogiris" class="nav-link active" data-toggle="tab" aria-selected="true">回答集</a>
    </li>
    <li class="nav-item" role="presentation">
      <a href="#user_comments" class="nav-link" data-toggle="tab" aria-selected="false">コメント集</a>
    </li>
    <li class="nav-item" role="presentation">
      <a href="#received_comments" class="nav-link" data-toggle="tab" aria-selected="false">貰ったコメント</a>
    </li>
  </ul>
  <div class="tab-content mt-3">
    <div id="user_oogiris" class="tab-pane active">
      <% @user_oogiris.each do |oogiri| %>
        <div class="col-sm-6 mx-auto small">
          <div class="p-1 shadow-sm border mb-2">
            <div class="card-body pt-2">
              <div class="text-dark text-center table-secondary p-2"><%= link_to oogiri.field.text_theme, field_oogiris_path(oogiri.field), class: "text-dark" %></div>
            </div>
            <div class="d-flex align-items-center">
              <div class="d-flex text-nowrap ml-2 mr-3 align-items-center">
                <% if oogiri.get_rank == 1 %>
                  <i class="fa-solid fa-fire-flame-curved mr-1 text-danger"></i>
                <% elsif oogiri.get_rank > 1 && oogiri.point < 0 %>
                  <i class="fa-solid fa-skull mr-1 text-dark small"></i>
                <% else %>
                  <i class="fa-solid fa-circle-dot mr-1 text-light small"></i>
                <% end %>
                <div class="mr-1"><%= "#{oogiri.get_rank}位" %></div>
                <div class=""><%= "#{oogiri.point}点" %></div>
              </div>
              <div class="container-fluid">
                <div class="d-flex small align-items-center row">
                  <% if oogiri.comments.present? %>
                    <i class="fa-regular fa-comment text-primary mr-1"></i>
                  <% else %>
                    <i class="fa-regular fa-comment text-muted mr-1"></i>
                  <% end %>
                  <%= link_to("/fields/#{oogiri.field.id}/oogiri/#{oogiri.id}/votes") do %>
                    <div class="d-flex small mr-1">
                      <% [3, 2, 1, 0, -2].each do |v| %>
                        <div class="border <%= 'table-secondary' if v == -2 %> mr-1 text-dark px-1"><%= "#{oogiri.votes.where(vote_point: v).length}" %></div>
                      <% end %>
                    </div>
                  <% end %>
                </div>
                <hr class="my-1 row">
                <div class="p-1 my-2 row"><%= link_to oogiri.content, field_oogiri_path(oogiri.field, oogiri), class: "text-dark" %></div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <div id="user_comments" class="tab-pane">
      <% @user_comments.each do |comment| %>
        <table class="table table-bordered table-striped small shadow-sm">
          <tr>
            <th nowrap class="text-center w-25">お題</th>
            <th class="text-center"><%= link_to comment.oogiri.field.text_theme, field_oogiris_path(comment.oogiri.field), class: "text-dark" %></th>
          </tr>
          <tr>
            <th nowrap class="text-center w-25">回答</th>
            <th class=""><%= comment.oogiri.content %></th>
          </tr>
          <tr>
            <th nowrap class="text-center w-25">コメント</th>
            <th class="">
              <%= link_to(field_oogiri_path(comment.oogiri.field, comment.oogiri), class: "text-dark") do %>
                <div class=""><%= simple_format(comment.content) %></div>
              <% end %>
            </th>
          </tr>
        </table>
      <% end %>
    </div>
    <div id="received_comments" class="tab-pane">
      <% @received_comments.each do |comment| %>
        <table class="table table-bordered table-striped small shadow-sm">
          <tr>
            <th nowrap class="text-center w-25">お題</th>
            <th class="text-center"><%= link_to comment.oogiri.field.text_theme, field_oogiris_path(comment.oogiri.field), class: "text-dark" %></th>
          </tr>
          <tr>
            <th nowrap class="text-center w-25">回答</th>
            <th class=""><%= link_to comment.oogiri.content, field_oogiri_path(comment.oogiri.field, comment.oogiri), class: "text-dark" %></th>
          </tr>
          <tr>
            <th class="text-center w-25"><span><%= comment.user.rate_class.html_safe %></span><%= link_to comment.user.name, user_path(comment.user), class: "text-dark" %></th>
            <th class="">
              <%= link_to(field_oogiri_path(comment.oogiri.field, comment.oogiri), class: "text-dark") do %>
                <div><%= simple_format(comment.content) %></div>
              <% end %>
            </th>
          </tr>
        </table>
      <% end %>
    </div>
  </div>
</div>