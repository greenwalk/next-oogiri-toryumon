<div class="my-3 col-sm-6 mx-auto">
  <div class="text-center mb-2 text-dark"><span><%= @user.rate_class.html_safe %></span><%= "#{@user.name} 様 の実績" %></div>
  <hr class="mt-2 mb-4 w-50">
  <div class="card-body border shadow-sm mb-3 py-2">
    <div class="text-dark p-2 small">
      <div>成績</div>
      <table class="table table-bordered table-striped">
        <tr>
          <th nowrap class="p-2 text-center">ランク</th>
          <th nowrap class="p-2 text-center"><span class="<%= 'text-danger' if @user_rank <= 3 %>"><%= @user_rank %></span><%= "/#{@users.length} 位" %></th>
        </tr>
        <tr>
          <th nowrap class="text-center">レート</th>
          <th nowrap class="text-center"><%= @user.rate %></th>
        </tr>
        <tr>
          <th nowrap class="text-center">最高レート</th>
          <th nowrap class="text-center"><%= @user.max_rate %></th>
        </tr>
        <tr>
          <th nowrap class="text-center">1位</th>
          <th nowrap class="text-center"><%= "#{@first_oogiris.length}回" %></th>
        </tr>
        <tr>
          <th nowrap class="text-center">マイナス</th>
          <th nowrap class="text-center"><%= "#{@minus_oogiris.length}回" %></th>
        </tr>
      </table>
    </div>
  </div>
  <div class="card-body border shadow-sm mb-3 py-2">
    <div class="text-dark p-2 small">
      <div>アクティビティ</div>
      <table class="table table-bordered mb-2">
        <tr>
          <th nowrap class="p-2 text-center w-50">大喜利を始めた時期</th>
          <th nowrap class="p-2 text-center"><%= @user.oogiri_start.strftime('%Y年%m月') %></th>
        </tr>
      </table>
      <table class="table table-bordered table-striped">
        <tr>
          <th nowrap class="p-2 text-center w-50">投稿回数（率）</th>
          <th nowrap class="p-2 text-center"><%= "#{@user_oogiris.length}回 (#{(@user_oogiris.length.to_f / @fields_num.to_f * 100).round(1)}%)" %></th>
        </tr>
        <tr>
          <th nowrap class="text-center w-50">投票回数（率）</th>
          <th nowrap class="text-center"><%= "#{@user_votes_num}回 (#{(@user_votes_num.to_f / @fields_num.to_f * 100).round(1)}%)" %></th>
        </tr>
        <tr>
          <th nowrap class="text-center w-50">コメント回数（率）</th>
          <th nowrap class="text-center"><%= "#{@user.comments.length}回 (#{(@user.comments.length.to_f / @fields_num.to_f * 100).round(1)}%)" %></th>
        </tr>
      </table>
    </div>
  </div>
  <ul class="nav nav-tabs justify-content-around" role="tablist">
    <li class="nav-item" role="presentation">
      <a href="#user_oogiris" class="nav-link active" data-toggle="tab" aria-selected="true">回答集</a>
    </li>
    <li class="nav-item" role="presentation">
      <a href="#user_comments" class="nav-link" data-toggle="tab" aria-selected="false">コメント集</a>
    </li>
  </ul>
  <div class="tab-content mt-3">
    <div id="user_oogiris" class="tab-pane active">
      <% @user_oogiris.each do |oogiri| %>
        <div class="col-sm-6 mx-auto small">
          <div class="p-1 shadow-sm border mb-2">
            <div class="card-body pt-2">
              <div class="text-dark text-center table-secondary p-2"><%= oogiri.field.text_theme %></div>
            </div>
            <div class="d-flex align-items-center">
              <div class="d-flex text-nowrap ml-2 mr-3 align-items-center">
                <% if oogiri.get_rank <= 3 %>
                  <i class="fa-solid fa-fire-flame-curved mr-1 text-danger"></i>
                <% elsif oogiri.get_rank > 3 && oogiri.point < 0 %>
                  <i class="fa-solid fa-skull mr-1 text-dark small"></i>
                <% else %>
                  <i class="fa-solid fa-circle-dot mr-1 text-light small"></i>
                <% end %>
                <div class="mr-1"><%= "#{oogiri.get_rank}位" %></div>
                <div class=""><%= "#{oogiri.point}点" %></div>
              </div>
              <div class="container-fluid">
                <div class="d-flex small align-top row">
                  <div class="d-flex small mr-1">
                    <% [3, 2, 1, 0, -2].each do |v| %>
                      <div class="border <%= 'table-secondary' if v == -2 %> mr-1 text-dark px-1"><%= "#{oogiri.votes.where(vote_point: v).length}" %></div>
                    <% end %>
                  </div>
                  <%= link_to(user_path(@user), class: "text-left small text-secondary") do %>
                    <div class="d-flex">
                      <div><%= oogiri.user.rate_class.html_safe if oogiri.user.rate >= 1550 %></div>
                      <div><%= oogiri.user.name %></div>
                    </div>
                  <% end %>
                </div>
                <hr class="my-1 row">
                <div class="p-1 my-2 row"><%= oogiri.content %></div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <div id="user_comments" class="tab-pane">
      <% @user_comments.each do |comment| %>
        <table class="table table-bordered table-striped small shadow-sm">
          <tr>
            <th nowrap class="text-center w-25">お題</th>
            <th class="text-center"><%= comment.oogiri.field.text_theme.truncate(20) %></th>
          </tr>
          <tr>
            <th nowrap class="text-center w-25">回答</th>
            <th class="text-center"><%= comment.oogiri.content.truncate(20) %></th>
          </tr>
          <tr>
            <th nowrap class="text-center w-25">コメント</th>
            <th class="text-center"><%= link_to comment.content, field_oogiri_path(comment.oogiri.field, comment.oogiri) %></th>
          </tr>
        </table>
      <% end %>
    </div>
  </div>
</div>